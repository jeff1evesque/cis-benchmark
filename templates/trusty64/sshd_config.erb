## CIS Ubuntu 14.04 LTS Server Benchmark
## v2.0.0 - 09-30-2016
##
## Description: this file is autogenerated by puppet.
##

## listen ports
Port 22

<% if @cis_5_2_2 %>
## CIS 5.2.2 Ensure SSH Protocol is set to 2 (Scored)
Protocol 2
<% end %>

## HostKeys for protocol version 2
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_dsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key

## Privilege Separation is turned on for security
UsePrivilegeSeparation yes

## Lifetime and size of ephemeral version 1 server key
KeyRegenerationInterval 3600
ServerKeyBits 1024

## Logging
SyslogFacility AUTH

<% if @cis_5_2_3 %>
## CIS 5.2.3 Ensure SSH LogLevel is set to INFO (Scored)
LogLevel INFO
<% end %>

<% if @cis_5_2_13 %>
## CIS 5.2.13 Ensure SSH LoginGraceTime is set to one minute or less (Scored)
LoginGraceTime 60
<% else %>
LoginGraceTime 120
<% end %>

StrictModes yes

RSAAuthentication yes
PubkeyAuthentication yes
#AuthorizedKeysFile     %h/.ssh/authorized_keys

<% if @cis_5_2_6 %>
##
## CIS 5.2.6 Ensure SSH IgnoreRhosts is enabled (Scored)
##
## Note: do not read the user's ~/.rhosts and ~/.shosts files
##
IgnoreRhosts yes
<% end %>

## requires host keys in /etc/ssh_known_hosts
RhostsRSAAuthentication no

<% if @cis_5_2_7 %>
## CIS 5.2.7 Ensure SSH HostbasedAuthentication is disabled (Scored)
HostbasedAuthentication no
<% end %>

<% if @cis_5_2_8 %>
## CIS 5.2.8 Ensure SSH root login is disabled (Scored)
PermitRootLogin no
<% end %>

## Uncomment if you don't trust ~/.ssh/known_hosts for RhostsRSAAuthentication
#IgnoreUserKnownHosts yes

<% if @cis_5_2_9 %>
## CIS 5.2.9 Ensure SSH PermitEmptyPasswords is disabled (Scored)
PermitEmptyPasswords no
<% end %>

<% if @cis_5_2_10 %>
## CIS 5.2.10 Ensure SSH PermitUserEnvironment is disabled (Scored)
PermitUserEnvironment no
<% end %>

<% if @cis_5_2_11 %>
## CIS 5.2.11 Ensure only approved MAC algorithms are used (Scored)
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,umac-128@openssh.com
<% end %>

<% if @cis_5_2_12 %>
## CIS 5.2.12 Ensure SSH Idle Timeout Interval is configured (Scored)
ClientAliveInterval 300
<% else %>
ClientAliveInterval 0
<% end %>

## Change to yes to enable challenge-response passwords (beware issues
## with some PAM modules and threads)
ChallengeResponseAuthentication no

## Change to no to disable tunnelled clear text passwords
PasswordAuthentication yes

<% if @cis_5_2_4 %>
## CIS 5.2.4 Ensure SSH X11 forwarding is disabled (Scored)
X11Forwarding no
<% else %>
X11Forwarding yes
<% end %>

X11DisplayOffset 10

<% if @cis_1_7_1_1 %>
## 1.7.1.1 Ensure message of the day is configured properly (Scored)
PrintMotd no
<% end %>

<% if @cis_5_2_5 %>
## CIS 5.2.5 Ensure SSH MaxAuthTries is set to 4 or less (Scored)
MaxAuthTries 4
<% end %>

PrintLastLog yes
TCPKeepAlive yes
## UseLogin no

## MaxStartups 10:30:60
## Banner /etc/issue.net

## Allow client to pass locale environment variables
AcceptEnv LANG LC_*

Subsystem sftp /usr/lib/openssh/sftp-server
